- id: Environment - Warning 1 - Medium
  alias: Environment - Warning 1 - Medium
  trigger:
  - above: '100'
    below: '200'
    entity_id: sensor.us_air_quality_index
    platform: numeric_state
  condition:
  - after: '6:00:00'
    before: '22:00:00'
    condition: time
  action:
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Không khí ô nhiễm, hạn chế mở cửa!
    service: tts.google_cloud_say
- id: Environment - Warning 2 - High
  alias: Environment - Warning 3 - High
  trigger:
  - above: '200'
    below: '300'
    entity_id: sensor.us_air_quality_index
    platform: numeric_state
  condition:
  - after: '6:00:00'
    before: '20:00:00'
    condition: time
  action:
  - data:
      data:
        subtitle:
      message: Rất xấu. Cảnh báo khẩn cấp về sức khỏe. Hạn chế ra ngoài.
      title: Chất lượng không khí
    service: notify.mobile_app_anh_tuan
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Không khí rất ô nhiễm, vui lòng đóng cửa, không ra khỏi nhà khi không
        cần thiết!
    service: tts.google_cloud_say
  - entity_id: automation.environment_warning_1_medium
    service: automation.turn_off
  - delay: 06:00:00
  - entity_id: automation.environment_warning_1_medium
    service: automation.turn_on
- id: Environment - Warning 3 - Dangerous
  alias: Environment - Warning 3 - Dangerous
  trigger:
  - above: '300'
    below: '5000'
    entity_id: sensor.us_air_quality_index
    platform: numeric_state
  condition:
  - after: '6:00:00'
    before: '21:00:00'
    condition: time
  action:
  - data:
      data:
        subtitle:
      message: Báo động ô nhiễm. Không nên ra khỏi nhà.
      title: Chất lượng không khí
    service: notify.mobile_app_anh_tuan
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Không khí đặc biệt ô nhiễm, vui lòng đóng cửa, không ra khỏi nhà!
    service: tts.google_cloud_say
  - entity_id: automation.environment_warning_1_medium
    service: automation.turn_off
  - entity_id: automation.environment_warning_2_high
    service: automation.turn_off
  - delay: 03:00:00
  - entity_id: automation.environment_warning_2_high
    service: automation.turn_on
  - entity_id: automation.environment_warning_1_medium
    service: automation.turn_on
- id: General - IR Remote
  alias: General - IR Remote
  trigger:
  - entity_id: switch.tv_fan1
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_fan2
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_hometheatre2
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_hometheatre3
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_hometheatre4
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_hometheatrer
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_robot
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_robot2
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.tv_robot3
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - entity_id: group.remote
    service: switch.turn_off
- id: HASS - turn off automation WC
  alias: HASS - turn off automation WC
  description: ''
  trigger:
  - event: start
    platform: homeassistant
  condition: []
  action:
  - delay: 00:05:00
  - entity_id: automation.wc1_ceiling_light_1_on
    service: automation.turn_on
  - entity_id: automation.wc1_ceiling_on_heating_off
    service: automation.turn_on
  - entity_id: automation.wc1_close_door
    service: automation.turn_on
  - entity_id: automation.wc1_glass_door_close_ceiling
    service: automation.turn_on
  - entity_id: automation.wc1_glass_door_close_heating_light
    service: automation.turn_on
  - entity_id: automation.wc1_heating_on_ceiling_off
    service: automation.turn_on
  - entity_id: automation.wc1_light_off
    service: automation.turn_on
  - entity_id: automation.wc1_light_on_off_automation_open_door
    service: automation.turn_on
  - entity_id: automation.wc1_open_door
    service: automation.turn_on
  - entity_id: automation.wc1_open_door_22h30_5h00
    service: automation.turn_on
  - entity_id: automation.wc1_open_door_when_lights_off
    service: automation.turn_on
  - entity_id: automation.wc2_ceiling_light_1_on
    service: automation.turn_on
  - entity_id: automation.wc2_ceiling_on_heating_off
    service: automation.turn_on
  - entity_id: automation.wc2_close_door
    service: automation.turn_on
  - entity_id: automation.wc2_glass_door_close_ceiling
    service: automation.turn_on
  - entity_id: automation.wc2_glass_door_close_heating_light
    service: automation.turn_on
  - entity_id: automation.wc2_heating_on_ceiling_off
    service: automation.turn_on
  - data: {}
    entity_id: automation.wc2_light_off
    service: automation.turn_on
  - data: {}
    entity_id: automation.wc2_light_on_off_automation_open_door
    service: automation.turn_on
  - data: {}
    entity_id: automation.wc2_open_door
    service: automation.turn_on
  - data: {}
    entity_id: automation.wc2_open_door_when_lights_off
    service: automation.turn_on
- id: update_networkmap
  alias: Zigbee - Update map
  trigger:
  - minutes: /10
    platform: time_pattern
    seconds: '0'
  action:
  - service: zigbee2mqtt_networkmap.update
  hide_entity: true
- id: General - Rain sensor - 5h00-22h00
  alias: General - Rain sensor - 5h00-22h00
  trigger:
  - entity_id: binary_sensor.0x00158d00029316d4_contact
    for: 00:00:10
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - above: '5'
    condition: numeric_state
    entity_id: sensor.0x00158d0002ea2bc8_linkquality
  - after: 05:00:00
    before: '22:00:00'
    condition: time
  action:
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Trời mưa! Vui lòng kiểm tra các cửa sổ.
    service: tts.google_cloud_say
  - data:
      data:
        type: announce
      message: It is raining! Please check windows and doors!
      target:
      - media_player.echo_dot
    service: notify.alexa_media_echo_bedroom_3
  - service: script.rain_delay_02h00
- id: General - Rain sensor - 22h00-05h00
  alias: General - Rain sensor - 22h00-05h00
  description: Thông báo mưa trên Echo Dot phòng ngủ 3
  trigger:
  - entity_id: binary_sensor.0x00158d00029316d4_contact
    for: 00:00:10
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - above: '1'
    condition: numeric_state
    entity_id: sensor.0x00158d0002ea2bc8_linkquality
  - condition: or
    conditions:
    - after: '22:00:00'
      condition: time
    - before: 05:00:00
      condition: time
  action:
  - data:
      data:
        type: announce
      message: It is raining! Please check windows and doors!
      target:
      - media_player.echo_dot
    service: notify.alexa_media_echo_bedroom_3
  - data:
      data:
        type: announce
      message: It is raining! Please check windows and doors!
      target:
      - media_player.echo_dot
    service: notify.alexa_media_echo_bedroom_3
  - service: script.rain_delay_08h00
- id: Entrance - Welcome (door close)
  alias: Entrance - Welcome (door close)
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d0002e75e45_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - after: 05:00:00
    before: '22:00:00'
    condition: time
  - condition: state
    entity_id: binary_sensor.virtual_door_motion_virtual
    state: 'on'
  action:
  - data: {}
    entity_id: automation.entrance_main_door_day_rain
    service: automation.turn_off
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Chào mừng bạn
    service: tts.google_cloud_say
  - delay: 00:01:00
  - entity_id: automation.entrance_main_door_day_rain
    service: automation.turn_on
- id: Entrance - Main door - Night
  alias: Entrance - Main door - Night
  description: Cửa mở khi tắt hết đèn vào tối hoặc đêm
  trigger:
  - entity_id: binary_sensor.0x00158d0002e75e45_contact
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.lv_mainlight11
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.lv_mainlight12
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.lv_sublight1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.lv_sublight2
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.kc_light1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.kc_light2
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.kc_light3
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: light.sonoff_100096209c
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: or
    conditions:
    - after: '18:30:00'
      condition: time
    - before: 05:00:00
      condition: time
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'off'
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight1
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light_1
    state: 'off'
  - condition: state
    entity_id: switch.kc_light2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light3
    state: 'off'
  - condition: state
    entity_id: light.sonoff_100096209c
    state: 'off'
  - condition: state
    entity_id: binary_sensor.0x00158d0002e75e45_contact
    state: 'on'
  action:
  - entity_id: switch.lv_mainlight11
    service: switch.turn_on
  - service: script.warning
- id: Entrance - Welcome (door open)
  alias: Entrance - Welcome (door open)
  description: ''
  trigger:
  - entity_id: binary_sensor.virtual_door_motion_virtual
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.0x00158d0002e75e45_contact
    state: 'on'
  - after: 05:00:00
    before: '22:00:00'
    condition: time
  action:
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Chào mừng bạn
    service: tts.google_cloud_say
- id: Entrance - Light on
  alias: Entrance - Light on
  trigger:
  - below: '80'
    entity_id: sensor.kc_illuminance_illuminance_lux
    platform: numeric_state
  condition: []
  action:
  - entity_id: switch.entrance_light
    service: switch.turn_on
- id: Entrance - Light off
  alias: Entrance - Light off
  trigger:
  - above: '80'
    entity_id: sensor.kc_illuminance_illuminance_lux
    platform: numeric_state
  - condition: template
    value_template: "{{ state_attr('cover.0x00158d00040c0e02_cover', 'current_position') | float < 1 }}"
  condition: []
  action:
  - entity_id: switch.entrance_light
    service: switch.turn_off
- id: Entrance - Main Door - Day Rain
  alias: Entrance - Main Door - Day Rain
  description: Mở cửa chính ban ngày nếu trời mưa
  trigger:
  - entity_id: binary_sensor.0x00158d0002e75e45_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.0x00158d00029316d4_contact
    state: 'off'
  - condition: and
    conditions:
    - after: 05:00:00
      condition: time
    - before: '22:00:00'
      condition: time
  - condition: state
    entity_id: binary_sensor.virtual_door_motion_virtual
    state: 'off'
  action:
  - data:
      entity_id: media_player.living_room_speaker_2
      volume_level: '0.6'
    service: media_player.volume_set
  - data:
      entity_id: media_player.living_room_speaker_2
      message: Trời có thể mưa. Vui lòng mang theo ô nếu bạn định ra khỏi nhà.
    service: tts.google_cloud_say
- id: Entrance - Welcome off
  alias: Entrance - Welcome off
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d0002e75e45_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.virtual_door_motion_virtual
    state: 'off'
  action:
  - entity_id: automation.entrance_welcome_door_open
    service: automation.turn_off
  - delay: 00:01:00
  - entity_id: automation.entrance_welcome_door_open
    service: automation.turn_on
- id: KC - Table - Sunset to 22h30
  alias: KC - Table - Sunset to 22h30
  description: Bật 2 đèn bếp sau khi mặt trời lặn cho tới 22h30
  trigger:
  - entity_id: binary_sensor.0x00158d00035037f3_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - before: '22:15:00'
    condition: time
  - condition: state
    entity_id: switch.kc_light3
    state: 'off'
  - below: '40'
    condition: numeric_state
    entity_id: sensor.kc_illuminance_illuminance_lux
  action:
  - entity_id: switch.kc_light1
    service: switch.turn_on
  - entity_id: switch.kc_light2
    service: switch.turn_on
- id: KC - Reflector 22h30-05h00
  alias: KC - Reflector 22h30-05h00
  description: Bật đèn hắt sau 22h30 và trước 5h00 sáng
  trigger:
  - entity_id: binary_sensor.0x00158d0002d3c211_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'off'
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight1
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light1
    state: 'off'
  - condition: state
    entity_id: switch.kc_light2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light3
    state: 'off'
  - condition: state
    entity_id: light.sonoff_100096209c
    state: 'off'
  - condition: or
    conditions:
    - after: '22:30:00'
      condition: time
    - before: 05:00:00
      condition: time
  action:
  - entity_id: light.sonoff_100096209c
    service: light.turn_on
  - delay: 00:01:00
  - entity_id: light.sonoff_100096209c
    service: light.turn_off
- id: KC - Reflector light ON
  alias: KC - Reflector light ON
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00020b5a9d_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - below: '110'
      condition: numeric_state
      entity_id: sensor.kc_illuminance_illuminance_lux
    - condition: template
      value_template: "{{ state_attr('cover.0x00158d00040c0e02_cover', 'current_position') | float < 40 }}"
  action:
  - entity_id: light.sonoff_100096209c
    service: light.turn_on
  - service: automation.turn_on
    entity_id: automation.kc_reflector_light_off
- id: KC - Reflector light OFF
  alias: KC - Reflector light OFF
  description: Tắt đèn gầm tủ bếp sau 2 phút
  trigger:
  - entity_id: binary_sensor.0x00158d00020b5a9d_occupancy
    for: 00:00:30
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: light.sonoff_100096209c
    service: light.turn_off
  - entity_id: automation.kc_reflector_light_off
    service: automation.turn_off
- id: KC - Reflector - OFF (ON by WC1 Door)
  alias: KC - Reflector - OFF (ON by WC1 Door)
  description: Tắt đèn hắt do mở cửa WC1 bật lên từ 22h30 đến 5h sáng
  trigger:
  - entity_id: binary_sensor.0x00158d0002d3c211_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - after: '22:30:00'
      condition: time
    - before: 05:00:00
      condition: time
  - condition: state
    entity_id: light.sonoff_100096209c
    state: 'on'
  action:
  - entity_id: light.sonoff_100096209c
    service: light.turn_off
  - delay: 00:00:05
  - entity_id: automation.kc_reflector_22h30_05h00
    service: automation.turn_on
  - entity_id: automation.kc_reflector_off_on_by_wc1_door
    service: automation.turn_off
- id: KC - Curtain ON
  alias: KC - Curtain ON
  description: ''
  trigger:
  - entity_id: switch.kc_curtain
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - entity_id: cover.0x00158d00040c0e02_cover
    service: cover.toggle
- id: KC - Curtain OFF
  alias: KC - Curtain OFF
  description: ''
  trigger:
  - entity_id: switch.kc_curtain
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: cover.0x00158d00040c0e02_cover
    service: cover.stop_cover
- id: LV - Light - Before 22h30
  alias: LV - Light - Before 22h30
  trigger:
  - entity_id: binary_sensor.0x00158d0002d3c211_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - before: '22:30:00'
    condition: time
  - after: sunset
    after_offset: -00:30:00
    condition: sun
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'off'
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight1
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light1
    state: 'off'
  - condition: state
    entity_id: switch.kc_light2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light3
    state: 'off'
  action:
  - entity_id: switch.lv_mainlight11
    service: switch.turn_on
- id: LV - Main light 1.1 on - 2.1 on
  alias: LV - Main light 1.1 on - 2.1 on
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight11
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight21
    state: 'off'
  action:
  - entity_id: switch.lv_mainlight21
    service: switch.turn_on
- id: LV - Main light 1.2 on - 2.2 on
  alias: LV - Main light 1.2 on - 2.2 on
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight12
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight22
    state: 'off'
  action:
  - entity_id: switch.lv_mainlight22
    service: switch.turn_on
- id: LV - Main light 1.1 off - 2.1 off
  alias: LV - Main light 1.1 off - 2.1 off
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight11
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight21
    state: 'on'
  action:
  - entity_id: switch.lv_mainlight21
    service: switch.turn_off
- id: LV - Main light 1.2 off - 2.2 off
  alias: LV - Main light 1.2 off - 2.2 off
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight12
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight22
    state: 'on'
  action:
  - entity_id: switch.lv_mainlight22
    service: switch.turn_off
- id: LV - Main light 2.1 on - 1.1 on
  alias: LV - Main light 2.1 on - 1.1 on
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight21
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'off'
  action:
  - entity_id: switch.lv_mainlight11
    service: switch.turn_on
- id: LV - Main light 2.2 on - 1.2 on
  alias: LV - Main light 2.2 on - 1.2 on
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight22
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'off'
  action:
  - entity_id: switch.lv_mainlight12
    service: switch.turn_on
- id: LV - Main light 2.2 off - 1.2 off
  alias: LV - Main light 2.2 off - 1.2 off
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight22
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'on'
  action:
  - entity_id: switch.lv_mainlight12
    service: switch.turn_off
- id: LV - Fan speed 1
  alias: LV - Fan speed 1
  description: ''
  trigger:
  - above: '20'
    below: '50'
    entity_id: sensor.0x00158d00023ff505_power
    platform: numeric_state
  condition: []
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.fan_lv_speed
      option: 1
- id: LV - Fan speed 2
  alias: LV - Fan speed 2
  description: ''
  trigger:
  - above: '51'
    below: '54'
    entity_id: sensor.0x00158d00023ff505_power
    platform: numeric_state
  condition: []
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.fan_lv_speed
      option: 2
- id: LV - Fan speed 3
  alias: LV - Fan speed 3
  description: ''
  trigger:
  - above: '55'
    entity_id: sensor.0x00158d00023ff505_power
    platform: numeric_state
  condition: []
  action:
  - service: input_select.select_option
    data_template:
      entity_id: input_select.fan_lv_speed
      option: 3
- id: LV - Fan on
  alias: LV - Fan on
  description: ''
  trigger:
  - above: '20'
    entity_id: sensor.0x00158d00023ff505_power
    platform: numeric_state
  condition:
  - condition: state
    entity_id: fan.fan_lv
    state: 'off'
  action:
  - entity_id: fan.fan_lv
    service: fan.turn_on
  - entity_id: input_boolean.fan_lv_power_state
    service: input_boolean.turn_on
- id: LV - Fan off
  alias: LV - Fan off
  description: ''
  trigger:
  - below: '20'
    entity_id: sensor.0x00158d00023ff505_power
    platform: numeric_state
  condition:
  - condition: state
    entity_id: fan.fan_lv
    state: 'on'
  action:
  - entity_id: fan.fan_lv
    service: fan.turn_off
  - entity_id: input_boolean.fan_lv_power_state
    service: input_boolean.turn_off
- id: LV - Main light 2.1 off - 1.1 off
  alias: LV - Main light 2.1 off - 1.1 off
  description: ''
  trigger:
  - entity_id: switch.lv_mainlight21
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'on'
  action:
  - entity_id: switch.lv_mainlight11
    service: switch.turn_off
- id: BR3 - Delay automation light
  alias: BR3 - Delay automation light
  trigger:
  - entity_id: switch.br3_light1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.br3_light2
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.br3_light_1_17_30_22_30
    service: automation.turn_off
  - entity_id: automation.br3_bed_lamp
    service: automation.turn_off
  - delay: 00:01:00
  - entity_id: automation.br3_light_1_17_30_22_30
    service: automation.turn_on
  - entity_id: automation.br3_bed_lamp
    service: automation.turn_on
- id: BR3 - Mi Led Desk Lamp ON
  alias: BR3 - Mi Led Desk Lamp ON
  description: Bật đèn bàn khi có chuyển động
  trigger:
  - entity_id: binary_sensor.0x00158d00044b09e1_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: and
    conditions:
    - below: '45'
      condition: numeric_state
      entity_id: sensor.kc_illuminance_illuminance_lux
    - before: '22:30:00'
      condition: time
  action:
  - data: {}
    entity_id: binary_sensor.virtual_br3_desk
    service: virtual.turn_on
  - data: {}
    entity_id: automation.br3_light_1_17_30_22_30
    service: automation.turn_off
  - data: {}
    entity_id: automation.br3_bed_lamp
    service: automation.turn_off
- id: BR3 - Mi Led Desk Lamp OFF
  alias: BR3 - Mi Led Desk Lamp OFF
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00044b09e1_occupancy
    from: 'on'
    platform: state
    to: 'off'
    for: 00:15:00
  condition: []
  action:
  - data: {}
    entity_id: binary_sensor.virtual_br3_desk
    service: virtual.turn_off
  - data: {}
    entity_id: automation.br3_light_1_17_30_22_30
    service: automation.turn_on
  - data: {}
    entity_id: automation.br3_bed_lamp
    service: automation.turn_on
- id: BR3 - Light 1 - 17:30-22:30
  alias: BR3 - Light 1 - 17:30-22:30
  description: Bật đèn 1 phòng ngủ 3 17h30-22h30
  trigger:
  - entity_id: binary_sensor.0x00158d00034faee2_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br3_light1
    state: 'off'
  - condition: state
    entity_id: switch.br3_light2
    state: 'off'
  - condition: and
    conditions:
    - below: '45'
      condition: numeric_state
      entity_id: sensor.kc_illuminance_illuminance_lux
    - before: '22:30:00'
      condition: time
    - after: 06:00:00
      condition: time
  action:
  - entity_id: switch.br3_light1
    service: switch.turn_on
- id: BR3 - Bed lamp
  alias: BR3 - Bed lamp
  description: Bật đèn ngủ phòng ngủ 3 từ 22h30-5h00
  trigger:
  - entity_id: binary_sensor.0x00158d00034faee2_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br3_light1
    state: 'off'
  - condition: state
    entity_id: switch.br3_light2
    state: 'off'
  - condition: or
    conditions:
    - after: '22:30:00'
      condition: time
    - before: 05:00:00
      condition: time
  action:
  - entity_id: switch.br3_light2
    service: switch.turn_on
- id: BR3 - Humidifier ON
  alias: BR3 - Humidifier ON
  trigger:
  - below: '63'
    entity_id: sensor.0x00158d00031e5213_humidity
    platform: numeric_state
  - above: '33'
    entity_id: sensor.0x00158d00031e5213_temperature
    platform: numeric_state
  - entity_id: device_tracker.hostname1
    from: not_home
    platform: state
    to: home
  condition:
  - condition: or
    conditions:
    - below: '63'
      condition: numeric_state
      entity_id: sensor.0x00158d00031e5213_humidity
    - above: '33'
      condition: numeric_state
      entity_id: sensor.0x00158d00031e5213_temperature
  - condition: state
    entity_id: device_tracker.hostname1
    state: home
  action:
  - entity_id: switch.0x00158d00024963da_switch
    service: switch.turn_on
- id: BR3 - Humidifier OFF
  alias: BR3 - Humidifier OFF
  description: Tắt máy bù ẩm phòng ngủ 3
  trigger:
  - above: '65'
    entity_id: sensor.0x00158d00031e5213_humidity
    platform: numeric_state
  - below: '33'
    entity_id: sensor.0x00158d00031e5213_temperature
    platform: numeric_state
  - entity_id: device_tracker.hostname1
    for: 00:02:00
    platform: state
    to: not_home
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - below: '33'
        condition: numeric_state
        entity_id: sensor.0x00158d00031e5213_temperature
      - above: '65'
        condition: numeric_state
        entity_id: sensor.0x00158d00031e5213_humidity
    - condition: state
      entity_id: device_tracker.hostname1
      state: not_home
  action:
  - entity_id: switch.0x00158d00024963da_switch
    service: switch.turn_off
- id: BR3 - Climate 27C when turn on
  alias: BR3 - Climate 27C when turn on
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d0002ec2698_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - entity_id: climate.ac_br3
    condition: state
    state: 'off'
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.ac_br3
      temperature: 27
      hvac_mode: cool
- id: BR3 - Climate off
  alias: BR3 - Climate off
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d0002ec2698_contact
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: climate.ac_br3
      hvac_mode: 'off'
    service: climate.set_hvac_mode
- id: BR2 - Fan speed 1
  alias: BR2 - Fan speed 1
  description: ''
  trigger:
  - above: '3.0'
    below: '4.9'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition: []
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - service: input_select.select_option
    data_template:
      entity_id: input_select.br2_fan_speed
      option: 1
  - delay: 00:00:01
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_on
- id: BR2 - Fan speed 3
  alias: BR2 - Fan speed 3
  description: ''
  trigger:
  - above: '5.0'
    below: '7.9'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition: []
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - service: input_select.select_option
    data_template:
      entity_id: input_select.br2_fan_speed
      option: 3
  - delay: 00:00:01
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_on
- id: BR2 - Fan speed 6
  alias: BR2 - Fan speed 6
  description: ''
  trigger:
  - above: '8.0'
    below: '14.9'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition: []
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - service: input_select.select_option
    data_template:
      entity_id: input_select.br2_fan_speed
      option: 6
  - delay: 00:00:01
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_on
- id: BR2 - Fan speed 8
  alias: BR2 - Fan speed 8
  description: ''
  trigger:
  - above: '15.0'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition: []
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - service: input_select.select_option
    data_template:
      entity_id: input_select.br2_fan_speed
      option: 8
  - delay: 00:00:01
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_on
- id: BR2 - Fan on
  alias: BR2 - Fan on
  description: ''
  trigger:
  - above: '3'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition:
  - condition: state
    entity_id: fan.br2_fan
    state: 'off'
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - entity_id: fan.br2_fan
    service: fan.turn_on
  - entity_id: input_boolean.br2_fan_power_state
    service: input_boolean.turn_on
  - delay: 00:00:01
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_on
- id: BR2 - Fan off
  alias: BR2 - Fan off (Off on fan before)
  description: ''
  trigger:
  - below: '2.0'
    entity_id: sensor.br2_fan_energy_power
    platform: numeric_state
  condition:
  - condition: state
    entity_id: fan.br2_fan
    state: 'on'
  action:
  - entity_id: binary_sensor.virtual_br2_auto_vs_manual
    service: virtual.turn_off
  - entity_id: fan.br2_fan
    service: fan.turn_off
  - entity_id: input_boolean.br2_fan_power_state
    service: input_boolean.turn_off
- id: BR2 - Delay automation light
  alias: BR2 - Delay automation light
  trigger:
  - entity_id: switch.br2_light11
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.br2_light12
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.br2_light13
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.br2_light_1_sunset_1_21h30
    service: automation.turn_off
  - entity_id: automation.br2_light_3_21h30_22h30
    service: automation.turn_off
  - delay: 00:01:00
  - entity_id: automation.br2_light_1_sunset_1_21h30
    service: automation.turn_on
  - entity_id: automation.br2_light_3_21h30_22h30
    service: automation.turn_on
- id: BR2 - Light 1 - Sunset (-1) - 21h30
  alias: BR2 - Light 1 - Sunset (-1) - 21h30
  trigger:
  - entity_id: binary_sensor.0x00158d000224829e_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: and
    conditions:
    - after: 06:00:00
      condition: time
    - before: '21:30:00'
      condition: time
  - condition: state
    entity_id: switch.br2_light11
    state: 'off'
  - condition: state
    entity_id: switch.br2_light12
    state: 'off'
  - condition: state
    entity_id: switch.br2_light13
    state: 'off'
  - below: '45'
    condition: numeric_state
    entity_id: sensor.kc_illuminance_illuminance_lux
  action:
  - entity_id: switch.br2_light11
    service: switch.turn_on
- id: BR2 - Light 3 - 21h30 - 22h30
  alias: BR2 - Light 3 - 21h30 - 22h30
  trigger:
  - entity_id: binary_sensor.0x00158d000224829e_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: and
    conditions:
    - before: '22:30:00'
      condition: time
    - after: '21:30:00'
      condition: time
  - condition: state
    entity_id: switch.br2_light11
    state: 'off'
  - condition: state
    entity_id: switch.br2_light12
    state: 'off'
  - condition: state
    entity_id: switch.br2_light13
    state: 'off'
  action:
  - entity_id: switch.br2_light13
    service: switch.turn_on
- id: BR2 - M1 on S1 on
  alias: BR2 - M1 on S1 on
  description: ''
  trigger:
  - entity_id: switch.br2_light11
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br2_light21
    state: 'off'
  action:
  - entity_id: switch.br2_light21
    service: switch.turn_on
- id: BR2 - M2 on S2 on
  alias: BR2 - M2 on S2 on
  description: ''
  trigger:
  - entity_id: switch.br2_light12
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br2_light22
    state: 'off'
  action:
  - entity_id: switch.br2_light22
    service: switch.turn_on
- id: BR2 - M3 on S3 on
  alias: BR2 - M3 on S3 on
  description: ''
  trigger:
  - entity_id: switch.br2_light13
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - entity_id: switch.br2_light23
    condition: state
    state: 'off'
  action:
  - service: switch.turn_on
    entity_id: switch.br2_light23
- id: BR2 - M1 off S1 off
  alias: BR2 - M1 off S1 off
  description: ''
  trigger:
  - entity_id: switch.br2_light11
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light21
    state: 'on'
  action:
  - entity_id: switch.br2_light21
    service: switch.turn_off
- id: BR2 - M2 off S2 off
  alias: BR2 - M2 off S2 off
  description: ''
  trigger:
  - entity_id: switch.br2_light12
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light22
    state: 'on'
  action:
  - entity_id: switch.br2_light22
    service: switch.turn_off
- id: BR2 - M3 off S3 off
  alias: BR2 - M3 off S3 off
  description: ''
  trigger:
  - entity_id: switch.br2_light13
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light23
    state: 'on'
  action:
  - entity_id: switch.br2_light23
    service: switch.turn_off
- id: BR2 - S1 on M1 on
  alias: BR2 - S1 on M1 on
  description: ''
  trigger:
  - entity_id: switch.br2_light21
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br2_light11
    state: 'off'
  action:
  - entity_id: switch.br2_light11
    service: switch.turn_on
- id: BR2 - S2 on M2 on
  alias: BR2 - S2 on M2 on
  description: ''
  trigger:
  - entity_id: switch.br2_light22
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br2_light12
    state: 'off'
  action:
  - entity_id: switch.br2_light12
    service: switch.turn_on
- id: BR2 - S3 on M3 on
  alias: BR2 - S3 on M3 on
  description: ''
  trigger:
  - entity_id: switch.br2_light23
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br2_light13
    state: 'off'
  action:
  - entity_id: switch.br2_light13
    service: switch.turn_on
- id: BR2 - S1 off M1 off
  alias: BR2 - S1 off M1 off
  description: ''
  trigger:
  - entity_id: switch.br2_light21
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light11
    state: 'on'
  action:
  - entity_id: switch.br2_light11
    service: switch.turn_off
- id: BR2 - S2 off M2 off
  alias: BR2 - S2 off M2 off
  description: ''
  trigger:
  - entity_id: switch.br2_light22
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light12
    state: 'on'
  action:
  - entity_id: switch.br2_light12
    service: switch.turn_off
- id: BR2 - S3 off M3 off
  alias: BR2 - S3 off M3 off
  description: ''
  trigger:
  - entity_id: switch.br2_light23
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br2_light13
    state: 'on'
  action:
  - entity_id: switch.br2_light13
    service: switch.turn_off
- id: BR2 - Climate 27C when turn on
  alias: BR2 - Climate 27C when turn on
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00025f0de5_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - entity_id: climate.ac_br2
    condition: state
    state: 'off'
  action:
  - service: climate.set_temperature
    data:
      entity_id: climate.ac_br2
      temperature: 27
      hvac_mode: cool
- id: BR2 - Climate off
  alias: BR2 - Climate off
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00025f0de5_contact
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: climate.ac_br2
      hvac_mode: 'off'
    service: climate.set_hvac_mode
- id: BR1 - Delay automation light
  alias: BR1 - Delay automation light
  trigger:
  - entity_id: switch.br1_light11
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.br1_light12
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.br1_light13
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.br1_light_1_sunset_1_21h30
    service: automation.turn_off
  - entity_id: automation.br1_light_2_21h30_22h30
    service: automation.turn_off
  - delay: 00:01:00
  - entity_id: automation.br1_light_1_sunset_1_21h30
    service: automation.turn_on
  - entity_id: automation.br1_light_2_21h30_22h30
    service: automation.turn_on
- id: BR1 - Light 1 - Sunset (-1) - 21h30
  alias: BR1 - Light 1 - Sunset (-1) - 21h30
  trigger:
  - entity_id: binary_sensor.0x00158d000290f025_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: and
    conditions:
    - after: 06:00:00
      condition: time
    - before: '21:30:00'
      condition: time
  - condition: state
    entity_id: switch.br1_light11
    state: 'off'
  - condition: state
    entity_id: switch.br1_light12
    state: 'off'
  - condition: state
    entity_id: switch.br1_light13
    state: 'off'
  - below: '45'
    condition: numeric_state
    entity_id: sensor.kc_illuminance_illuminance_lux
  action:
  - entity_id: switch.br1_light11
    service: switch.turn_on
- id: BR1 - Light 3 - 21h30 - 22h30
  alias: BR1 - Light 2 - 21h30 - 22h30
  trigger:
  - entity_id: binary_sensor.0x00158d000290f025_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: and
    conditions:
    - before: '22:30:00'
      condition: time
    - after: '21:30:00'
      condition: time
  - condition: state
    entity_id: switch.br1_light11
    state: 'off'
  - condition: state
    entity_id: switch.br1_light12
    state: 'off'
  - condition: state
    entity_id: switch.br1_light13
    state: 'off'
  action:
  - entity_id: switch.br1_light13
    service: switch.turn_on
- id: BR1 - TV on when Power off
  alias: BR1 - TV on when Power off
  description: ''
  trigger:
  - entity_id: media_player.br1_tv_sony
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.br1_tv_power
    state: 'off'
  action:
  - service: switch.turn_on
    entity_id: switch.br1_tv_power
- id: BR1 - TV off when Power on
  alias: BR1 - TV off when Power on
  description: ''
  trigger:
  - entity_id: media_player.br1_tv_sony
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.br1_tv_power
    state: 'on'
  action:
  - service: switch.turn_on
    entity_id: switch.br1_tv_power
- id: BR1 - TV - Power on when TV off
  alias: BR1 - TV - Power on when TV off
  description: ''
  trigger:
  - entity_id: binary_sensor.br1_tv_power
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: media_player.br1_tv_sony
    state: 'off'
  action:
  - service: media_player.turn_on
    entity_id: media_player.br1_tv_sony
- id: BR1 - TV - Power off when TV on
  alias: BR1 - TV - Power off when TV on
  description: ''
  trigger:
  - entity_id: binary_sensor.br1_tv_power
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: media_player.br1_tv_sony
    state: 'on'
  action:
  - service: media_player.turn_off
    entity_id: media_player.br1_tv_sony
- id: BR1 - M1 on S1 on
  alias: BR1 - M1 on S1 on
  description: ''
  trigger:
  - entity_id: switch.br1_light11
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light21
    state: 'off'
  action:
  - entity_id: switch.br1_light21
    service: switch.turn_on
- id: BR1 - M2 on S2 on
  alias: BR1 - M2 on S2 on
  description: ''
  trigger:
  - entity_id: switch.br1_light12
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light22
    state: 'off'
  action:
  - entity_id: switch.br1_light22
    service: switch.turn_on
- id: BR1 - M3 on S3 on
  alias: BR1 - M3 on S3 on
  description: ''
  trigger:
  - entity_id: switch.br1_light13
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light23
    state: 'off'
  action:
  - entity_id: switch.br1_light23
    service: switch.turn_on
- id: BR1 - M1 off S1 off
  alias: BR1 - M1 off S1 off
  description: ''
  trigger:
  - entity_id: switch.br1_light11
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light21
    state: 'on'
  action:
  - entity_id: switch.br1_light21
    service: switch.turn_off
- id: BR1 - M2 off S2 off
  alias: BR1 - M2 off S2 off
  description: ''
  trigger:
  - entity_id: switch.br1_light12
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light22
    state: 'on'
  action:
  - entity_id: switch.br1_light22
    service: switch.turn_off
- id: BR1 - M3 off S3 off
  alias: BR1 - M3 off S3 off
  description: ''
  trigger:
  - entity_id: switch.br1_light13
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light23
    state: 'on'
  action:
  - entity_id: switch.br1_light23
    service: switch.turn_off
- id: BR1 - S1 on M1 on
  alias: BR1 - S1 on M1 on
  description: ''
  trigger:
  - entity_id: switch.br1_light21
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light11
    state: 'off'
  action:
  - entity_id: switch.br1_light11
    service: switch.turn_on
- id: BR1 - S2 on M2 on
  alias: BR1 - S2 on M2 on
  description: ''
  trigger:
  - entity_id: switch.br1_light22
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light12
    state: 'off'
  action:
  - entity_id: switch.br1_light12
    service: switch.turn_on
- id: BR1 - S3 on M3 on
  alias: BR1 - S3 on M3 on
  description: ''
  trigger:
  - entity_id: switch.br1_light23
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.br1_light13
    state: 'off'
  action:
  - entity_id: switch.br1_light13
    service: switch.turn_on
- id: BR1 - S1 off M1 off
  alias: BR1 - S1 off M1 off
  description: ''
  trigger:
  - entity_id: switch.br1_light21
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light11
    state: 'on'
  action:
  - entity_id: switch.br1_light11
    service: switch.turn_off
- id: BR1 - S2 off M2 off
  alias: BR1 - S2 off M2 off
  description: ''
  trigger:
  - entity_id: switch.br1_light22
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light12
    state: 'on'
  action:
  - entity_id: switch.br1_light12
    service: switch.turn_off
- id: BR1 - S3 off M3 off
  alias: BR1 - S3 off M3 off
  description: ''
  trigger:
  - entity_id: switch.br1_light23
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.br1_light13
    state: 'on'
  action:
  - entity_id: switch.br1_light13
    service: switch.turn_off
- id: BR1 - Climate turn on
  alias: BR1 - Climate turn on
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00044da114_contact
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      entity_id: climate.ac_br1
      hvac_mode: cool
      temperature: 27
    service: climate.set_temperature
- id: BR1 - Climate off
  alias: BR1 - Climate off
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d00044da114_contact
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data:
      entity_id: climate.ac_br1
      hvac_mode: 'off'
    service: climate.set_hvac_mode
- id: WC1 - Delay automation light
  alias: WC1 - Delay automation light
  trigger:
  - entity_id: switch.wc1_light1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.wc1_light2
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.wc1_open_door_when_lights_off
    service: automation.turn_off
  - delay: 00:00:15
  - entity_id: automation.wc1_open_door_when_lights_off
    service: automation.turn_on
- id: WC1 - Ceiling light 1 - On
  alias: WC1 - Ceiling light 1 - On
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d000228147e_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc1_light2
    state: 'off'
  - condition: state
    entity_id: switch.wc1_light1
    state: 'off'
  action:
  - entity_id: switch.wc1_light1
    service: switch.turn_on
- id: WC1 - Light - Off
  alias: WC1 - Light - Off
  trigger:
  - entity_id: binary_sensor.0x00158d000228147e_occupancy
    for: 00:00:05
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.0x00158d000293171b_contact
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc1_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc1_light2
      state: 'on'
  action:
  - entity_id: switch.wc1_light2
    service: switch.turn_off
  - entity_id: switch.wc1_light1
    service: switch.turn_off
  initial_state: false
- id: WC1 - Glass door close - Ceiling
  alias: WC1 - Glass door close - Ceiling
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d000293171b_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - above: '22'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc1_waterheater
    service: switch.turn_off
- id: WC1 - Glass door close - Heating light
  alias: WC1 - Glass door close - Heating light
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d000293171b_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - below: '22'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc1_light2
    service: switch.turn_on
  - entity_id: switch.wc1_waterheater
    service: switch.turn_off
- id: WC1 - Close Door
  alias: WC1 - Close Door
  trigger:
  - entity_id: binary_sensor.0x00158d0002ea2bc8_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc1_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc1_light2
      state: 'on'
  action:
  - entity_id: automation.wc1_light_off
    service: automation.turn_off
  initial_state: false
- id: WC1 - Open Door
  alias: WC1 - Open Door
  initial_state: false
  description: ''
  trigger:
  - entity_id: binary_sensor.0x00158d0002ea2bc8_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc1_light2
      state: 'on'
    - condition: state
      entity_id: switch.wc1_light1
      state: 'on'
  action:
  - entity_id: switch.wc1_light2
    service: switch.turn_off
  - entity_id: switch.wc1_light1
    service: switch.turn_off
  - entity_id: automation.wc1_light_off
    service: automation.turn_on
- id: WC1 - Light ON - OFF Automation Open Door
  alias: WC1 - Light ON - OFF Automation Open Door
  initial_state: false
  trigger:
  - entity_id: switch.wc1_light2
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.wc1_light1
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - entity_id: automation.wc1_open_door
    service: automation.turn_off
  - delay: 00:00:01
  - entity_id: automation.wc1_open_door
    service: automation.turn_on
- id: WC1 - Open Door when lights off
  alias: WC1 - Open Door when lights off
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d0002ea2bc8_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc1_light2
    state: 'off'
  - condition: state
    entity_id: switch.wc1_light1
    state: 'off'
  action:
  - entity_id: automation.wc1_open_door
    service: automation.turn_off
  - entity_id: switch.wc1_light1
    service: switch.turn_on
  - delay: 00:00:02
  - entity_id: automation.wc1_open_door
    service: automation.turn_on
- id: WC1 - Open Door - 22h30-5h00
  alias: WC1 - Open Door - 22h30-5h00
  initial_state: false
  description: Bật đèn bếp 3 khi ra khỏi cửa WC1 ban đêm và các đèn đều tắt
  trigger:
  - entity_id: binary_sensor.0x00158d0002ea2bc8_contact
    for: 00:00:01
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - before: 05:00:00
      condition: time
    - after: '22:30:00'
      condition: time
  - condition: state
    entity_id: switch.lv_mainlight11
    state: 'off'
  - condition: state
    entity_id: switch.lv_mainlight12
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight1
    state: 'off'
  - condition: state
    entity_id: switch.lv_sublight2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light1
    state: 'off'
  - condition: state
    entity_id: switch.kc_light2
    state: 'off'
  - condition: state
    entity_id: switch.kc_light3
    state: 'off'
  - condition: state
    entity_id: light.sonoff_100096209c
    state: 'off'
  action:
  - entity_id: light.sonoff_100096209c
    service: light.turn_on
  - entity_id: automation.kc_reflector_off_on_by_wc1_door
    service: automation.turn_on
  - entity_id: automation.kc_reflector_22h30_05h00
    service: automation.turn_off
- id: WC1 - Heating on Ceiling off
  alias: WC1 - Heating on Ceiling off
  initial_state: false
  description: ''
  trigger:
  - entity_id: switch.wc1_light2
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc1_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc1_waterheater
      state: 'on'
  action:
  - entity_id: switch.wc1_light1
    service: switch.turn_off
  - entity_id: switch.wc1_waterheater
    service: switch.turn_off
- id: WC1 - Ceiling on Heating off
  alias: WC1 - Ceiling on Heating off
  initial_state: false
  description: ''
  trigger:
  - entity_id: switch.wc1_light1
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc1_light2
    state: 'on'
  action:
  - entity_id: switch.wc1_light2
    service: switch.turn_off
- id: WC1 - Water Heater <20C 25 minutes
  alias: WC1 - Water Heater <20C 25 minutes
  initial_state: true
  description: ''
  trigger:
  - entity_id: switch.wc1_water_heater
    for: 00:25:00
    platform: state
    to: 'on'
  condition:
  - below: '21'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc1_waterheater
    service: switch.turn_off
- id: WC1 - Water Heater >=20C 15 minutes
  alias: WC1 - Water Heater >=20C 15 minutes
  initial_state: true
  description: ''
  trigger:
  - entity_id: switch.wc1_waterheater
    for: 00:15:00
    platform: state
    to: 'on'
  condition:
  - above: '20'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc1_waterheater
    service: switch.turn_off
- id: WC2 - Delay automation light
  alias: WC2 - Delay automation light
  trigger:
  - entity_id: switch.wc2_light1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: switch.wc2_light2
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: automation.wc2_open_door_when_lights_off
    service: automation.turn_off
  - delay: 00:00:15
  - entity_id: automation.wc2_open_door_when_lights_off
    service: automation.turn_on
- id: WC2 - Ceiling light 1 Fan
  alias: WC2 - Ceiling light 1 Fan
  trigger:
  - entity_id: switch.wc2_light1
    for: 00:03:00
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc2_light1
    state: 'on'
  - condition: state
    entity_id: switch.wc2_light2
    state: 'off'
  - condition: state
    entity_id: binary_sensor.0x00158d0002ec2699_contact
    state: 'off'
  - condition: state
    entity_id: binary_sensor.0x00158d0002c98705_contact
    state: 'on'
  action:
  - entity_id: switch.wc2_fan
    service: switch.turn_on
  initial_state: true
- id: WC2 - Fan OFF
  alias: WC2 - Fan OFF
  trigger:
  - entity_id: switch.wc2_light1
    from: 'on'
    platform: state
    to: 'off'
  - entity_id: binary_sensor.0x00158d0002ec2699_contact
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: binary_sensor.0x00158d0002c98705_contact
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: switch.wc2_fan
    service: switch.turn_off
  initial_state: true
- id: WC2 - Ceiling light 1 - On
  alias: WC2 - Ceiling light 1 - On
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d00031667e0_occupancy
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc2_light1
    state: 'off'
  - condition: state
    entity_id: switch.wc2_light2
    state: 'off'
  action:
  - entity_id: switch.wc2_light1
    service: switch.turn_on
- id: WC2 - Light - Off
  alias: WC2 - Light - Off
  trigger:
  - entity_id: binary_sensor.0x00158d00031667e0_occupancy
    for: 00:00:05
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.0x00158d0002c98705_contact
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc2_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc2_light2
      state: 'on'
  action:
  - entity_id: switch.wc2_light1
    service: switch.turn_off
  - entity_id: switch.wc2_light2
    service: switch.turn_off
  initial_state: false
- id: WC2 - Glass door close - Ceiling
  alias: WC2 - Glass door close - Ceiling
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d0002c98705_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - above: '22'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc2_waterheater
    service: switch.turn_off
  - entity_id: switch.wc2_light1
    service: switch.turn_on
- id: WC2 - Glass door close - Heating light
  alias: WC2 - Glass door close - Heating light
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d000293171b_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - below: '22'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc2_light2
    service: switch.turn_on
  - entity_id: switch.wc2_waterheater
    service: switch.turn_off
- id: WC2 - Close Door
  alias: WC2 - Close Door
  trigger:
  - entity_id: binary_sensor.0x00158d0002ec2699_contact
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc2_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc2_light2
      state: 'on'
  action:
  - entity_id: automation.wc2_light_off
    service: automation.turn_off
  initial_state: false
- id: WC2 - Open Door
  alias: WC2 - Open Door
  trigger:
  - entity_id: binary_sensor.0x00158d0002ec2699_contact
    for: 00:00:01
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc2_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc2_light2
      state: 'on'
  action:
  - entity_id: switch.wc2_light1
    service: switch.turn_off
  - entity_id: switch.wc2_light2
    service: switch.turn_off
  - entity_id: automation.wc2_light_off
    service: automation.turn_on
  - entity_id: switch.wc2_fan
    service: switch.turn_off
  initial_state: false
- id: WC2 - Light ON - OFF Automation Open Door
  alias: WC2 - Light ON - OFF Automation Open Door
  initial_state: false
  trigger:
  - entity_id: switch.wc2_light1
    from: 'off'
    platform: state
    to: 'on'
  - entity_id: switch.wc2_light2
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - entity_id: automation.wc2_open_door
    service: automation.turn_off
  - delay: 00:00:01
  - entity_id: automation.wc2_open_door
    service: automation.turn_on
- id: WC2 - Open Door when lights off
  alias: WC2 - Open Door when lights off
  initial_state: false
  trigger:
  - entity_id: binary_sensor.0x00158d0002ec2699_contact
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc2_light1
    state: 'off'
  - condition: state
    entity_id: switch.wc2_light2
    state: 'off'
  action:
  - entity_id: automation.wc2_open_door
    service: automation.turn_off
  - entity_id: switch.wc2_light1
    service: switch.turn_on
  - delay: 00:00:02
  - entity_id: automation.wc2_open_door
    service: automation.turn_on
- id: WC2 - Ceiling on Heating off
  alias: WC2 - Ceiling on Heating off
  initial_state: false
  description: ''
  trigger:
  - entity_id: switch.wc2_light1
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.wc2_light2
    state: 'on'
  action:
  - entity_id: switch.wc2_light2
    service: switch.turn_off
- id: WC2 - Heating on Ceiling off
  alias: WC2 - Heating on Ceiling off
  initial_state: false
  description: ''
  trigger:
  - entity_id: switch.wc2_light2
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: switch.wc2_light1
      state: 'on'
    - condition: state
      entity_id: switch.wc2_waterheater
      state: 'on'
  action:
  - entity_id: switch.wc2_light1
    service: switch.turn_off
  - entity_id: switch.wc2_waterheater
    service: switch.turn_off
- id: WC2 - Water Heater <20C 25 minutes
  alias: WC2 - Water Heater <20C 25 minutes
  initial_state: true
  description: ''
  trigger:
  - entity_id: switch.wc2_waterheater
    for: 00:25:00
    platform: state
    to: 'on'
  condition:
  - below: '21'
    condition: numeric_state
    entity_id: sensor.xiaomi_temp
  action:
  - entity_id: switch.wc2_waterheater
    service: switch.turn_off
- id: WC2 - Water Heater >=20C 15 minutes
  alias: WC2 - Water Heater >=20C 15 minutes
  initial_state: true
  description: ''
  trigger:
  - entity_id: switch.wc2_waterheater
    for: 00:15:00
    platform: state
    to: 'on'
  condition:
  - above: '20'
    condition: numeric_state
    entity_id: sensor.0x00158d00031e5213_temperature
  action:
  - entity_id: switch.wc2_waterheater
    service: switch.turn_off
- id: BC - Light ON
  alias: BC - Light ON
  description: ''
  trigger:
  - entity_id: switch.bc_light
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - entity_id: light.sonoff_10008481b8
    service: light.turn_on
  - entity_id: light.sonoff_1000961870
    service: light.turn_on
- id: BC - Light OFF
  alias: BC - Light OFF
  description: ''
  trigger:
  - entity_id: switch.bc_light
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - entity_id: light.sonoff_10008481b8
    service: light.turn_off
  - entity_id: light.sonoff_1000961870
    service: light.turn_off
- id: Entrance - Motion Virtual ON
  alias: Entrance - Motion Virtual ON
  description: ''
  trigger:
  - entity_id: binary_sensor.xiaofang_motion_sensor
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data: {}
    entity_id: binary_sensor.virtual_door_motion_virtual
    service: virtual.turn_on
- id: Entrance - Motion Virtual OFF
  alias: Entrance - Motion Virtual OFF
  description: ''
  trigger:
  - entity_id: binary_sensor.xiaofang_motion_sensor
    from: 'on'
    platform: state
    to: 'off'
    for: 00:01:00
  condition: []
  action:
  - data: {}
    entity_id: binary_sensor.virtual_door_motion_virtual
    service: virtual.turn_off
